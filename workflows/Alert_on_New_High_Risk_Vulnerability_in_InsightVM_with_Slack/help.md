# Description

This workflow listens for InsightVM Webhook Events for newly discovered vulnerabilities, checks the CVSS score of each new vulnerability, and posts notifications for high-risk (by default, CVSS > 7) vulnerabilities to a Slack channel.

This workflow helps Security and IT teams raise awareness of newly discovered, high-risk vulnerabilities. The workflow includes a link to the relevant vulnerability page in InsightVM, along with host information regarding the vulnerable asset and the solution details for remediation.

# Key Features

* Heightened awareness of newly discovered, high-risk vulnerabilities
* VM Events trigger utilizes InsightVM's new webhook feature
* Flexible workflow design allows for easy customization

# Requirements

* Insight Platform User API Key
* [Slack](https://insightconnect.help.rapid7.com/docs/configure-slack-for-chatops)
* InsightVM
* InsightConnect

# Documentation

## Setup

**In order to use this workflow, you will need to subscribe to the InsightVM Vulnerabilities Found webhook event. You will also need to adjust the Slack channel names to match your environment.**

Import the workflow from the Rapid7 Extension Library and proceed through the Import Workflow wizard in InsightConnect. Import plugins, create or select connections, and rename the workflow as a part of the Import Workflow wizard as necessary.

Once the workflow has been imported, open the workflow and view the InsightVM Events trigger step. Save the trigger configuration step and proceed through the Instructions on subscribing to the InsightVM Vulnerabilities Found Webhook Event. This will require an [Insight Platform User API Key](https://docs.rapid7.com/insight/managing-platform-api-keys#generating-a-user-key). Insert your User API Key, copy the API request, run it from a command prompt, and look for a JSON response including an ID. If you receive a JSON response, then your webhook event subscription is active! Close your command prompt and return to the workflow in InsightConnect.

After subscribing to the vulnerabilities found webhook event, return to the workflow editor and open the `SETTINGS` step. In the input field, change the pre-specified slack_channel_name from `change_me` to a channel name in your Slack environment where you would like vulnerability notifications delivered. We recommend a private channel with representatives from security and remediation teams for the best visibility.

After configuring the Slack channel setting, activate the workflow. Any newly discovered vulnerability will generate a webhook event, which will trigger your workflow, which will look up the vulnerability CVSS score, see if it is greater than or equal to 7, and then post information about high-risk vulnerabilities to the specified Slack channel!

### Adjusting the Vulnerability Filter

By default, the workflow posts notifications for all vulnerabilities with a risk score greater than 7. This filter logic may be adjusted by editing the `Risk > 7?` step, located inside the `Process Vulnerabilities` loop. This automated decision can be adjusted or extended to include additional factors. See InsightConnect's Help Documentation for more information on [using decision steps](https://docs.rapid7.com/insightconnect/lesson-4-use-decision-steps/#lesson-4-use-decision-steps) and on the [decision query language](https://docs.rapid7.com/insightconnect/format-query-language/#operators).
 
## Technical Details

Plugins utilized by workflow:

|Plugin|Version|Count|
|----|----|--------|
|Rapid7 Vulnerability & Exploit Database|2.0.3|1|
|Rapid7 InsightVM|4.7.0|1|
|Type Converter|1.6.0|2|
|HTML|1.2.2|1|


## Troubleshooting

_There is no troubleshooting information at this time_

# Version History

* 1.0.0 - Initial workflow

# Links

## References

* [Rapid7 Vulnerability & Exploit Database](https://rapid7.com/db)
* [Slack](https://slack.com)
