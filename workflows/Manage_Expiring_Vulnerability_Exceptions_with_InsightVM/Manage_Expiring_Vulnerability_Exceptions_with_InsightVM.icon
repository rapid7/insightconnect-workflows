{
  "kom": {
    "komandVersion": "1.61.2-0-g02b95",
    "komFileVersion": "2.0.0",
    "exportedAt": "2020-09-15T14:14:50.623444097Z",
    "workflowVersions": [
      {
        "name": "Manage Expiring Vulnerability Exceptions with InsightVM",
        "type": "runnable",
        "version": "",
        "description": "This workflow will create a slack message to the user weekly and notify them of any expiring exceptions.",
        "graph": {
          "edges": {
            "1860bffb-1f92-4989-aa29-5699bf9cbd9a": {
              "id": "1860bffb-1f92-4989-aa29-5699bf9cbd9a",
              "name": "",
              "description": "",
              "parentNodeId": "",
              "fromNodeId": "ab6b2ea4-a963-48c4-8a58-51f9141e0d24",
              "toNodeId": "4bf56fd5-2e45-4ab2-90ca-d8df5ba5971a"
            },
            "595c473c-74af-4c92-83ef-57c43cd0063b": {
              "id": "595c473c-74af-4c92-83ef-57c43cd0063b",
              "name": "5 or less",
              "description": "",
              "parentNodeId": "",
              "fromNodeId": "7595f444-5c98-457b-ba52-b38863ae878a",
              "toNodeId": "6f37cc6a-ddca-4931-ab23-96015984341a"
            },
            "698325b6-c9b2-4915-8db5-60ded96bc5e3": {
              "id": "698325b6-c9b2-4915-8db5-60ded96bc5e3",
              "name": "",
              "description": "",
              "parentNodeId": "",
              "fromNodeId": "9c37b91a-d658-4269-a92c-596ae0f92006",
              "toNodeId": ""
            },
            "77a880aa-1555-41d2-bd54-9ec4b74afa25": {
              "id": "77a880aa-1555-41d2-bd54-9ec4b74afa25",
              "name": "",
              "description": "",
              "parentNodeId": "",
              "fromNodeId": "4bf56fd5-2e45-4ab2-90ca-d8df5ba5971a",
              "toNodeId": "715f6f94-06c6-4ae0-8861-b50e0c332166"
            },
            "77b976c4-a810-4c19-96ba-ca88bb2c9a45": {
              "id": "77b976c4-a810-4c19-96ba-ca88bb2c9a45",
              "name": "",
              "description": "",
              "parentNodeId": "",
              "fromNodeId": "6f37cc6a-ddca-4931-ab23-96015984341a",
              "toNodeId": ""
            },
            "8e091eab-dee2-49ec-80c4-29363562c370": {
              "id": "8e091eab-dee2-49ec-80c4-29363562c370",
              "name": "",
              "description": "",
              "parentNodeId": "",
              "fromNodeId": "30b50fee-2433-49b6-a14c-1620134336bc",
              "toNodeId": ""
            },
            "b082b439-e203-478a-80ab-9b33aa770d4e": {
              "id": "b082b439-e203-478a-80ab-9b33aa770d4e",
              "name": "",
              "description": "",
              "parentNodeId": "",
              "fromNodeId": "715f6f94-06c6-4ae0-8861-b50e0c332166",
              "toNodeId": "7595f444-5c98-457b-ba52-b38863ae878a"
            },
            "bf76fc19-108c-4dd7-80db-3c1f62e89ae0": {
              "id": "bf76fc19-108c-4dd7-80db-3c1f62e89ae0",
              "name": "Zero",
              "description": "",
              "parentNodeId": "",
              "fromNodeId": "7595f444-5c98-457b-ba52-b38863ae878a",
              "toNodeId": "9c37b91a-d658-4269-a92c-596ae0f92006"
            },
            "d635d795-9f9c-47d0-ac1b-d6145f5e344f": {
              "id": "d635d795-9f9c-47d0-ac1b-d6145f5e344f",
              "name": "More than 5",
              "description": "",
              "parentNodeId": "",
              "fromNodeId": "7595f444-5c98-457b-ba52-b38863ae878a",
              "toNodeId": "30b50fee-2433-49b6-a14c-1620134336bc"
            }
          },
          "nodes": {
            "30b50fee-2433-49b6-a14c-1620134336bc": {
              "id": "30b50fee-2433-49b6-a14c-1620134336bc",
              "parentNodeId": ""
            },
            "4bf56fd5-2e45-4ab2-90ca-d8df5ba5971a": {
              "id": "4bf56fd5-2e45-4ab2-90ca-d8df5ba5971a",
              "parentNodeId": ""
            },
            "6f37cc6a-ddca-4931-ab23-96015984341a": {
              "id": "6f37cc6a-ddca-4931-ab23-96015984341a",
              "parentNodeId": ""
            },
            "715f6f94-06c6-4ae0-8861-b50e0c332166": {
              "id": "715f6f94-06c6-4ae0-8861-b50e0c332166",
              "parentNodeId": ""
            },
            "7595f444-5c98-457b-ba52-b38863ae878a": {
              "id": "7595f444-5c98-457b-ba52-b38863ae878a",
              "parentNodeId": ""
            },
            "9c37b91a-d658-4269-a92c-596ae0f92006": {
              "id": "9c37b91a-d658-4269-a92c-596ae0f92006",
              "parentNodeId": ""
            },
            "ab6b2ea4-a963-48c4-8a58-51f9141e0d24": {
              "id": "ab6b2ea4-a963-48c4-8a58-51f9141e0d24",
              "parentNodeId": ""
            }
          }
        },
        "steps": {
          "30b50fee-2433-49b6-a14c-1620134336bc": {
            "nodeId": "30b50fee-2433-49b6-a14c-1620134336bc",
            "name": "More than 5 message",
            "type": "action_chatops",
            "continueOnFailure": false,
            "isDisabled": false,
            "parameters": {
              "input": {
                "attachments": [],
                "message": "⚠  *Expiring Exceptions*  ⚠\n\nID: {{[4bf56fd5-2e45-4ab2-90ca-d8df5ba5971a].[exceptions].[0].[id]}}\nName: {{[4bf56fd5-2e45-4ab2-90ca-d8df5ba5971a].[exceptions].[0].[scope].[vulnerability]}}\nExpires: {{[4bf56fd5-2e45-4ab2-90ca-d8df5ba5971a].[exceptions].[0].[expires]}}\n\nID: {{[4bf56fd5-2e45-4ab2-90ca-d8df5ba5971a].[exceptions].[1].[id]}}\nName: {{[4bf56fd5-2e45-4ab2-90ca-d8df5ba5971a].[exceptions].[1].[scope].[vulnerability]}}\nExpires: {{[4bf56fd5-2e45-4ab2-90ca-d8df5ba5971a].[exceptions].[1].[expires]}}\n\nID: {{[4bf56fd5-2e45-4ab2-90ca-d8df5ba5971a].[exceptions].[2].[id]}}\nName: {{[4bf56fd5-2e45-4ab2-90ca-d8df5ba5971a].[exceptions].[2].[scope].[vulnerability]}}\nExpires: {{[4bf56fd5-2e45-4ab2-90ca-d8df5ba5971a].[exceptions].[2].[expires]}}\n\nID: {{[4bf56fd5-2e45-4ab2-90ca-d8df5ba5971a].[exceptions].[3].[id]}}\nName: {{[4bf56fd5-2e45-4ab2-90ca-d8df5ba5971a].[exceptions].[3].[scope].[vulnerability]}}\nExpires: {{[4bf56fd5-2e45-4ab2-90ca-d8df5ba5971a].[exceptions].[3].[expires]}}\n\nID: {{[4bf56fd5-2e45-4ab2-90ca-d8df5ba5971a].[exceptions].[4].[id]}}\nName: {{[4bf56fd5-2e45-4ab2-90ca-d8df5ba5971a].[exceptions].[4].[scope].[vulnerability]}}\nExpires: {{[4bf56fd5-2e45-4ab2-90ca-d8df5ba5971a].[exceptions].[4].[expires]}}\n\n... More than 5 expiring exceptions found. The complete list can be found here: \n{{[$job].[URL]}}",
                "recipient": "#change_me",
                "thread_ts": ""
              }
            },
            "defaultInputJSONSchema": {
              "properties": {
                "attachments": {
                  "description": "JSON array of attachments - see https://api.slack.com/docs/message-attachments (Advanced)",
                  "items": {
                    "type": "object"
                  },
                  "order": 4,
                  "title": "Attachments",
                  "type": "array"
                },
                "message": {
                  "description": "Message to send",
                  "order": 3,
                  "title": "Message",
                  "type": "string"
                },
                "recipient": {
                  "description": "Channels begin with # (e.g. #channel) and usernames begin with @ (e.g. @username)",
                  "order": 1,
                  "title": "Enter #channel or @username",
                  "type": "string"
                },
                "thread_ts": {
                  "description": "Select timestamp output variable from parent message step",
                  "order": 2,
                  "title": "To post in a thread, select parent message timestamp",
                  "type": "string"
                }
              },
              "required": [
                "recipient"
              ],
              "title": "Variables",
              "type": "object"
            },
            "defaultOutputJSONSchema": {
              "properties": {
                "channel_id": {
                  "description": "ChannelID of successful message",
                  "order": 1,
                  "title": "Channel ID",
                  "type": "string"
                },
                "timestamp": {
                  "description": "Timestamp of successful message",
                  "order": 2,
                  "title": "Timestamp",
                  "type": "string"
                }
              },
              "title": "Variables",
              "type": "object"
            },
            "outputJSONSchema": null,
            "defaultImageData": "",
            "connectionType": "NONE",
            "chatOpsAppName": "slack",
            "chatOpsIdentifier": "post_message"
          },
          "4bf56fd5-2e45-4ab2-90ca-d8df5ba5971a": {
            "nodeId": "4bf56fd5-2e45-4ab2-90ca-d8df5ba5971a",
            "name": "Get Expiring Exceptions",
            "type": "action",
            "plugin": {
              "name": "Rapid7 InsightVM",
              "slugVendor": "rapid7",
              "slugName": "rapid7_insightvm",
              "slugVersion": "4.4.0",
              "imageData": "https://us.cdn-assets.connect.insight.rapid7.com/icons/rapid7/rapid7_insightvm/4.4.0/icon.png"
            },
            "identifier": "get_expiring_vulnerability_exceptions",
            "continueOnFailure": false,
            "isDisabled": false,
            "isCloud": false,
            "parameters": {
              "input": {
                "expires_in_less_than": 14
              }
            },
            "defaultInputJSONSchema": {
              "properties": {
                "expires_in_less_than": {
                  "default": 7,
                  "description": "Number of days left until the exception expires",
                  "order": 1,
                  "title": "Expires in Less Than",
                  "type": "integer"
                }
              },
              "required": [
                "expires_in_less_than"
              ],
              "title": "Variables",
              "type": "object"
            },
            "defaultOutputJSONSchema": {
              "definitions": {
                "link": {
                  "properties": {
                    "href": {
                      "description": "A hypertext reference, which is either a URI (see RFC 3986) or URI template (see RFC 6570)",
                      "order": 1,
                      "title": "URL",
                      "type": "string"
                    },
                    "rel": {
                      "description": "Link relation type following RFC 5988",
                      "order": 2,
                      "title": "Rel",
                      "type": "string"
                    }
                  },
                  "title": "Link",
                  "type": "object"
                },
                "vulnerability_exception": {
                  "properties": {
                    "expires": {
                      "description": "The date and time the vulnerability exception is set to expire",
                      "displayType": "date",
                      "format": "date-time",
                      "order": 1,
                      "title": "Expires",
                      "type": "string"
                    },
                    "id": {
                      "description": "The ID uniquely identifying the vulnerability exception",
                      "order": 3,
                      "title": "Vulnerability Exception ID",
                      "type": "integer"
                    },
                    "links": {
                      "description": "Hypermedia links to corresponding or related resources",
                      "items": {
                        "$ref": "#/definitions/link"
                      },
                      "order": 7,
                      "title": "Links",
                      "type": "array"
                    },
                    "review": {
                      "description": "Details of the exception review",
                      "order": 6,
                      "title": "Review Details",
                      "type": "object"
                    },
                    "scope": {
                      "description": "Details of the scope of the exception",
                      "order": 4,
                      "title": "Exception Scope",
                      "type": "object"
                    },
                    "state": {
                      "description": "The state of the vulnerability exception",
                      "enum": [
                        "deleted",
                        "expired",
                        "approved",
                        "rejected",
                        "under review"
                      ],
                      "order": 2,
                      "title": "State",
                      "type": "string"
                    },
                    "submit": {
                      "description": "Details of the exception submission",
                      "order": 5,
                      "title": "Submission Details",
                      "type": "object"
                    }
                  },
                  "required": [
                    "state",
                    "id",
                    "scope",
                    "submit"
                  ],
                  "title": "Vulnerability Exception",
                  "type": "object"
                }
              },
              "properties": {
                "exceptions": {
                  "description": "Exceptions about to expire",
                  "items": {
                    "$ref": "#/definitions/vulnerability_exception"
                  },
                  "order": 1,
                  "title": "Exceptions",
                  "type": "array"
                }
              },
              "title": "Variables",
              "type": "object"
            },
            "outputJSONSchema": null,
            "defaultImageData": "",
            "connectionType": "CONNECTION"
          },
          "6f37cc6a-ddca-4931-ab23-96015984341a": {
            "nodeId": "6f37cc6a-ddca-4931-ab23-96015984341a",
            "name": "Less than 5 exceptions found",
            "type": "action_chatops",
            "continueOnFailure": false,
            "isDisabled": false,
            "parameters": {
              "input": {
                "attachments": [],
                "message": "⚠  *Expiring Exceptions*  ⚠\n\n{{#each [4bf56fd5-2e45-4ab2-90ca-d8df5ba5971a].[exceptions]}}\nID: {{this.[id]}}\nName: {{this.[scope].[vulnerability]}}\nExpires: {{this.[expires]}}\n\n{{/each}}\n\n",
                "recipient": "change_me",
                "thread_ts": ""
              }
            },
            "defaultInputJSONSchema": {
              "properties": {
                "attachments": {
                  "description": "JSON array of attachments - see https://api.slack.com/docs/message-attachments (Advanced)",
                  "items": {
                    "type": "object"
                  },
                  "order": 4,
                  "title": "Attachments",
                  "type": "array"
                },
                "message": {
                  "description": "Message to send",
                  "order": 3,
                  "title": "Message",
                  "type": "string"
                },
                "recipient": {
                  "description": "Channels begin with # (e.g. #channel) and usernames begin with @ (e.g. @username)",
                  "order": 1,
                  "title": "Enter #channel or @username",
                  "type": "string"
                },
                "thread_ts": {
                  "description": "Select timestamp output variable from parent message step",
                  "order": 2,
                  "title": "To post in a thread, select parent message timestamp",
                  "type": "string"
                }
              },
              "required": [
                "recipient"
              ],
              "title": "Variables",
              "type": "object"
            },
            "defaultOutputJSONSchema": {
              "properties": {
                "channel_id": {
                  "description": "ChannelID of successful message",
                  "order": 1,
                  "title": "Channel ID",
                  "type": "string"
                },
                "timestamp": {
                  "description": "Timestamp of successful message",
                  "order": 2,
                  "title": "Timestamp",
                  "type": "string"
                }
              },
              "title": "Variables",
              "type": "object"
            },
            "outputJSONSchema": null,
            "defaultImageData": "",
            "connectionType": "NONE",
            "chatOpsAppName": "slack",
            "chatOpsIdentifier": "post_message"
          },
          "715f6f94-06c6-4ae0-8861-b50e0c332166": {
            "nodeId": "715f6f94-06c6-4ae0-8861-b50e0c332166",
            "name": "Create CSV",
            "type": "artifact",
            "continueOnFailure": false,
            "isDisabled": false,
            "parameters": {
              "input": {
                "content": "{{#each [4bf56fd5-2e45-4ab2-90ca-d8df5ba5971a].[exceptions]}}\n{{this.[id]}},{{this.[expires]}},{{this.[scope].[vulnerability]}},{{this.[links].[0].[href]}}\n{{/each}}\n\n"
              },
              "type": "markdown"
            },
            "defaultInputJSONSchema": null,
            "defaultOutputJSONSchema": null,
            "outputJSONSchema": null,
            "defaultImageData": "https://us.cdn-assets.connect.insight.rapid7.com/step-type-icons/artifact.svg",
            "connectionType": "NONE"
          },
          "7595f444-5c98-457b-ba52-b38863ae878a": {
            "nodeId": "7595f444-5c98-457b-ba52-b38863ae878a",
            "name": "How many exceptions",
            "type": "automated_decision",
            "continueOnFailure": false,
            "isDisabled": false,
            "parameters": {
              "defaultEdgeId": "d635d795-9f9c-47d0-ac1b-d6145f5e344f",
              "stepControlParams": [
                {
                  "edgeId": "595c473c-74af-4c92-83ef-57c43cd0063b",
                  "expression": {
                    "left": {
                      "left": {
                        "args": [
                          {
                            "name": "4bf56fd5-2e45-4ab2-90ca-d8df5ba5971a.exceptions",
                            "type": "variable"
                          }
                        ],
                        "name": "length",
                        "type": "function"
                      },
                      "op": "<",
                      "right": {
                        "type": "literal",
                        "value": 6
                      },
                      "type": "binary"
                    },
                    "op": "AND",
                    "right": {
                      "left": {
                        "args": [
                          {
                            "name": "4bf56fd5-2e45-4ab2-90ca-d8df5ba5971a.exceptions",
                            "type": "variable"
                          }
                        ],
                        "name": "length",
                        "type": "function"
                      },
                      "op": ">",
                      "right": {
                        "type": "literal",
                        "value": 0
                      },
                      "type": "binary"
                    },
                    "type": "binary"
                  },
                  "expressionText": "length({{[4bf56fd5-2e45-4ab2-90ca-d8df5ba5971a].[exceptions]}}) < 6 AND length({{[4bf56fd5-2e45-4ab2-90ca-d8df5ba5971a].[exceptions]}}) > 0"
                },
                {
                  "edgeId": "bf76fc19-108c-4dd7-80db-3c1f62e89ae0",
                  "expression": {
                    "left": {
                      "args": [
                        {
                          "name": "4bf56fd5-2e45-4ab2-90ca-d8df5ba5971a.exceptions",
                          "type": "variable"
                        }
                      ],
                      "name": "length",
                      "type": "function"
                    },
                    "op": "==",
                    "right": {
                      "type": "literal",
                      "value": 0
                    },
                    "type": "binary"
                  },
                  "expressionText": "length({{[4bf56fd5-2e45-4ab2-90ca-d8df5ba5971a].[exceptions]}}) == 0"
                },
                {
                  "edgeId": "d635d795-9f9c-47d0-ac1b-d6145f5e344f",
                  "expression": {},
                  "expressionText": ""
                }
              ]
            },
            "defaultInputJSONSchema": null,
            "defaultOutputJSONSchema": null,
            "outputJSONSchema": null,
            "defaultImageData": "https://us.cdn-assets.connect.insight.rapid7.com/step-type-icons/automated-decision.svg",
            "connectionType": "NONE"
          },
          "9c37b91a-d658-4269-a92c-596ae0f92006": {
            "nodeId": "9c37b91a-d658-4269-a92c-596ae0f92006",
            "name": "No expiring exceptions message",
            "type": "action_chatops",
            "continueOnFailure": false,
            "isDisabled": false,
            "parameters": {
              "input": {
                "attachments": [],
                "message": "✅  *No expiring exceptions found*  ✅",
                "recipient": "#change_me",
                "thread_ts": ""
              }
            },
            "defaultInputJSONSchema": {
              "properties": {
                "attachments": {
                  "description": "JSON array of attachments - see https://api.slack.com/docs/message-attachments (Advanced)",
                  "items": {
                    "type": "object"
                  },
                  "order": 4,
                  "title": "Attachments",
                  "type": "array"
                },
                "message": {
                  "description": "Message to send",
                  "order": 3,
                  "title": "Message",
                  "type": "string"
                },
                "recipient": {
                  "description": "Channels begin with # (e.g. #channel) and usernames begin with @ (e.g. @username)",
                  "order": 1,
                  "title": "Enter #channel or @username",
                  "type": "string"
                },
                "thread_ts": {
                  "description": "Select timestamp output variable from parent message step",
                  "order": 2,
                  "title": "To post in a thread, select parent message timestamp",
                  "type": "string"
                }
              },
              "required": [
                "recipient"
              ],
              "title": "Variables",
              "type": "object"
            },
            "defaultOutputJSONSchema": {
              "properties": {
                "channel_id": {
                  "description": "ChannelID of successful message",
                  "order": 1,
                  "title": "Channel ID",
                  "type": "string"
                },
                "timestamp": {
                  "description": "Timestamp of successful message",
                  "order": 2,
                  "title": "Timestamp",
                  "type": "string"
                }
              },
              "title": "Variables",
              "type": "object"
            },
            "outputJSONSchema": null,
            "defaultImageData": "",
            "connectionType": "NONE",
            "chatOpsAppName": "slack",
            "chatOpsIdentifier": "post_message"
          },
          "ab6b2ea4-a963-48c4-8a58-51f9141e0d24": {
            "nodeId": "ab6b2ea4-a963-48c4-8a58-51f9141e0d24",
            "name": "Weekly Timer",
            "type": "trigger",
            "plugin": {
              "name": "Timers",
              "slugVendor": "rapid7",
              "slugName": "timers",
              "slugVersion": "2.0.4",
              "imageData": "https://us.cdn-assets.connect.insight.rapid7.com/icons/rapid7/timers/2.0.4/icon.png"
            },
            "identifier": "weekly",
            "continueOnFailure": false,
            "isDisabled": false,
            "parameters": {
              "input": {
                "day": "Monday",
                "message": "",
                "times_in_utc": "00:00:01"
              }
            },
            "triggerId": "a3eefdde-9601-428a-ba6e-2678c4099db0",
            "defaultInputJSONSchema": {
              "properties": {
                "day": {
                  "description": "Names of the day that you want the trigger to run",
                  "order": 1,
                  "title": "Day",
                  "type": "string"
                },
                "message": {
                  "description": "The message to send (optional)",
                  "order": 3,
                  "title": "Message",
                  "type": "string"
                },
                "times_in_utc": {
                  "description": "A comma-separated list of UTC times on those days when you want the trigger to occur",
                  "order": 2,
                  "title": "Time in UTC",
                  "type": "string"
                }
              },
              "required": [
                "day",
                "times_in_utc"
              ],
              "title": "Variables",
              "type": "object"
            },
            "defaultOutputJSONSchema": {
              "properties": {
                "message": {
                  "description": "Message",
                  "order": 1,
                  "title": "Message",
                  "type": "string"
                },
                "time": {
                  "description": "Time",
                  "order": 2,
                  "title": "Time",
                  "type": "string"
                }
              },
              "title": "Variables",
              "type": "object"
            },
            "outputJSONSchema": null,
            "defaultImageData": "https://us.cdn-assets.connect.insight.rapid7.com/step-type-icons/default.svg",
            "connectionType": "ORCHESTRATOR"
          }
        },
        "tags": null,
        "humanCostSeconds": 1800,
        "humanCostDisplayUnit": "minutes"
      }
    ],
    "triggers": [
      {
        "id": "a3eefdde-9601-428a-ba6e-2678c4099db0",
        "identifier": "weekly",
        "name": "Weekly Timer",
        "description": "",
        "input": {
          "day": "Monday",
          "message": "",
          "times_in_utc": "00:00:01"
        },
        "inputJsonSchema": {
          "properties": {
            "day": {
              "description": "Names of the day that you want the trigger to run",
              "order": 1,
              "title": "Day",
              "type": "string"
            },
            "message": {
              "description": "The message to send (optional)",
              "order": 3,
              "title": "Message",
              "type": "string"
            },
            "times_in_utc": {
              "description": "A comma-separated list of UTC times on those days when you want the trigger to occur",
              "order": 2,
              "title": "Time in UTC",
              "type": "string"
            }
          },
          "required": [
            "day",
            "times_in_utc"
          ],
          "title": "Variables",
          "type": "object"
        },
        "outputJsonSchema": {
          "properties": {
            "message": {
              "description": "Message",
              "order": 1,
              "title": "Message",
              "type": "string"
            },
            "time": {
              "description": "Time",
              "order": 2,
              "title": "Time",
              "type": "string"
            }
          },
          "title": "Variables",
          "type": "object"
        },
        "tags": [],
        "type": "trigger_plugin",
        "plugin": {
          "name": "Timers",
          "slugVendor": "rapid7",
          "slugName": "timers",
          "slugVersion": "2.0.4",
          "imageData": "https://us.cdn-assets.connect.insight.rapid7.com/icons/rapid7/timers/2.0.4/icon.png"
        }
      }
    ]
  }
}