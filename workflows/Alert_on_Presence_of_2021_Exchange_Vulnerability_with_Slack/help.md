# Description

This workflow listens for InsightVM Webhook Events for newly discovered vulnerabilities, checks if a 2021 Exchange Server (CVE-2021-26412, CVE-2021-26854, CVE-2021-26855, CVE-2021-26857, CVE-2021-26858, CVE-2021-27065, or CVE-2021-27078) or derivative) vulnerability is present, and if found, posts a notification to a Slack channel.

This workflow helps Security and IT teams have awareness of this critical high-risk vulnerability. The Slack message posted includes a link to more information about the specific version of the vulnerability, along with host information regarding the vulnerable asset and the solution details for remediation.

# Key Features

* Heightened awareness of this critical vulnerability in your environment
* VM Events trigger utilizes InsightVM's new webhook feature
* Flexible workflow design allows for easy customization and updating for current vulnerabilities

# Requirements

* Insight Platform User API Key
* [Slack](https://insightconnect.help.rapid7.com/docs/configure-slack-for-chatops)
* InsightVM
* InsightConnect

# Documentation

## Setup

**In order to use this workflow, you will need to subscribe to the InsightVM Vulnerabilities Found webhook event. You will also need to set the Slack channel parameter to match your environment.**

Import the workflow from the Rapid7 Extension Library and proceed through the Import Workflow wizard in InsightConnect. Import plugins, create or select connections, and rename the workflow as a part of the Import Workflow wizard as necessary.

Once the workflow has been imported, open the workflow and view the InsightVM Events trigger step. Save the trigger configuration step and proceed through the Instructions on subscribing to the InsightVM Vulnerabilities Found Webhook Event. This will require an [Insight Platform User API Key](https://docs.rapid7.com/insight/managing-platform-api-keys#generating-a-user-key). Insert your User API Key, copy the API request, run it from a command prompt, and look for a JSON response including an ID. If you receive a JSON response, then your webhook event subscription is active! Close your command prompt and return to the workflow in InsightConnect.

After subscribing to the vulnerabilities found webhook event, return to the workflow editor or the control panel page and set the "Slack Channel Name" parameter to a channel where you would like vulnerability alerts delivered. We recommend a private channel with representatives from security and remediation teams for the best visibility.

After configuring the Slack channel parameter, activate the workflow. Any newly discovered vulnerability will generate a webhook event, which will trigger your workflow. If the vulnerability is a 2021 Exchange Server vulnerability or related, then the workflow will trigger a message with details to the specified Slack channel!

### Adapting the Workflow to New Vulnerabilities

By default, the workflow detects specific vulnerabilities matching or containing the 2021 Exchange Server CVEs: CVE-2021-26412, CVE-2021-26854, CVE-2021-26855, CVE-2021-26857, CVE-2021-26858, CVE-2021-27065, or CVE-2021-27078. It can be easily updated for other pressing vulnerabilities by changing the ID within the "Is 2021 Exchange Vuln?" decision step within the "Loop Over found Vulnerabilities" loop. See InsightConnect's Help Documentation for more information on [using decision steps](https://docs.rapid7.com/insightconnect/lesson-4-use-decision-steps/#lesson-4-use-decision-steps) and on the [decision query language](https://docs.rapid7.com/insightconnect/format-query-language/#operators).
 
## Technical Details

Plugins utilized by workflow:

|Plugin|Version|Count|
|----|----|--------|
|Rapid7 Vulnerability & Exploit Database|2.0.3|1|


## Troubleshooting

Experiencing delays? InsightVM Events are delivered to InsightConnect from InsightVM as soon as the Insight platform is notified of a change by the on-premises InsightVM Security Console. This can take anywhere from 5 minutes to several hours. Please be patient!

# Version History

* 1.0.0 - Initial workflow

# Links

## References

* [Rapid7 Vulnerability & Exploit Database](https://rapid7.com/db)
* [Slack](https://slack.com)
* [InsightVM Events Trigger](https://docs.rapid7.com/insightconnect/set-up-an-insightvm-events-trigger)
